# 캐시 메모리(Cache Memory)

캐시 메모리는 속도 차이가 나는 장치간에서서 생기는 병목 현상을 줄이기 위한 메모리를 말한다.

`ex1) CPU 코어와 메모리 사이의 병목 현상 완화
ex2) 웹 브라우저 캐시 파일은 하드디스크와 웹페이지 사이의 병목 현상을 완화
`
### 캐시 메모리 특징

- CPU가 주기억장치에서 저장된 데이터를 읽어올 때, 자주 사용하는 데이터를 캐시 메모리에 저장한 뒤
   다음에 이용할 때 주기억장치가 아닌 캐시 메모리에서 먼저 가져오면서 속도를 향상시킨다.

- 속도가 빠르지만 용량이 적 비용이 비싸다. (SRAM 가격이 매우 비싸기에 크기가 작다)

- CPU에는 캐시 메모리가 2~3개 정도 있다
- 속도와 크기에 따라 L1, L2, L3 캐시 메모리라고 불리며, 일반적으로 L1 캐시부터 먼저 사용된다.

### 듀얼 코어 프로세서의 캐시 메모리
- 각 코어마다 독립된 L1 캐시 메모리를 가지고, 두 코어가 공유하는 L2 캐시 메모리가 내장된다.
- 만약 L1 캐시가 128kb면, 64/64로 나누어 64kb에 명령어를 처리하기 직전의 명령어를 임시 저장하고,
  나머지 64kb에는 실행 후 명령어를 임시저장한다.
  * 명령어 세트 : 명령어 캐시(I-Cache) + 데이터 캐시(D-Cache)
  * L1 : CPU 내부에 존재
  * L2 : CPU와 RAM 사이에 존재
  * L3 : 보통 메인보드에 존재한다고 함
 
### 디스크 캐시
주기억장치(RAM)와 보조기억장치(HDD) 사이에 존재하는 캐시 캐시 메모리(Cache Memory)

### 캐시 메모리 작동 원리
- 시간 지역성
  - for나 while 같은 반복문에 사용하는 조건 변수처럼, 한번 참조된 데이터는 잠시 후 또 참조될 가능성이 높음
- 공간 지역성
  - A[0], A[1]과 같은 연속 접근 시 참조된 데이터 근처에 있는 데이터가 잠시 후 또 사용될 가능성이 높음
 
- 캐시에 데이터를 저장할 때는, 이러한 참조 지역성(공간)을 최대한 활용하기 위해 해당 데이터뿐만 아니라,
- 옆 주소의 데이터도 같이 가져와 미래에 쓰일 것을 대비한다.
- CPU가 요청한 데이터가 캐시에 있으면 'Cache Hit', 없어서 DRAM에서 가져오면 'Cache Miss'

### 캐시 미스
- Cold miss : 해당 메모리 주소를 한 번도 로드한 적이 없기 때문에 나는 미스
- Conflict miss: 캐시 메모리에 A와 B 데이터를 저장해야 하는데,
  A와 B가 같은 캐시 메모리 주소에 할당되어 있어서 나는 미스 (direct mapped cache에서 많이 발생)
- Capacity miss: 캐시 메모리의 크기가 작아서 필요한 모든 데이터를 저장하지 못할 때 발생
  ⚠️ 캐시 크기를 키워서 문제를 해결하려하면, 캐시 접근속도가 느려지고 파워를 많이 먹는 단점이 생김

### 구조 및 작동 방식
![image](https://github.com/user-attachments/assets/6aea2b64-cb7d-4c19-850d-37d862248b49)

- Direct Mapped Cache (인덱스 필드 + 태그 필드 + 데이터 필드)
  - 가장 기본적인 구조로, DRAM의 여러 주소가 캐시 메모리의 한 주소에 대응되는 다대일 방식
  - 간단하고 빠른 장점이 있지만, Conflict Miss가 발생하는 것이 단점
- Fully Associative Cache (태그 필드 + 데이터 필드)
  - 비어있는 캐시 메모리가 있으면, 마음대로 주소를 저장하는 방식
  - 조건이나 규칙이 없어서 특정 캐시 Set 안에 있는 모든 블럭을 한번에 찾아 원하는 데이터가 있는지 검색해야 한다.
  - CAM이라는 특수한 메모리 구조를 사용해야하지만 가격이 매우 비싸다.
- Set Associative Cache (인덱스 필드 + 태그 필드 + 데이터 필드)
  - Direct + Fully 방식
  - 특정 행을 지정하고, 그 행안의 어떤 열이든 비어있을 때 저장하는 방식
  - Direct에 비해 검색 속도는 느리지만, 저장이 빠르고 Fully에 비해 저장이 느린 대신 검색이 빠른 중간형
 
---
# ❓질문
- 캐시 메모리 특징에 대해 설명하시오.
  ```
  고속 액세스: CPU와 주 메모리(RAM) 사이에 위치하여 자주 사용되는 데이터와 명령어를 빠르게 제공
  계층적 구조: 일반적으로 L1, L2, L3 단계로 구성되며, L1이 가장 빠르고 작음
  작은 용량: 메인 메모리보다 훨씬 작지만 훨씬 빠른 SRAM으로 구성
  지역성 원리 활용: 시간 지역성(최근 참조된 데이터가 곧 다시 참조될 가능성)과 공간 지역성(인접 데이터가 연이어 참조될 가능성)을 이용
  ```
  
- 캐시 미스 중 Conflict miss에 대해서 설명하시오
  ```
  Conflict miss는 서로 다른 메모리 주소의 데이터가 동일한 캐시 위치에 매핑되어 발생하는 캐시 미스
  메모리 주소 A의 데이터가 캐시의 특정 위치에 저장된 상태에서
  ➡️ 다른 메모리 주소 B가 동일한 캐시 위치에 매핑되면
  ➡️ B를 로드할 때 A 데이터가 캐시에서 밀려나게 됨
  ➡️ 이후 다시 A 데이터에 접근하면 캐시에 없으므로 메인 메모리에서 가져와야 하는 미스가 발생
  ```
- Fully Associative Cache 인덱스 필드가 없다. 왜일까?

```
메모리 블록을 캐시의 어느 위치에나 자유롭게 저장할 수 있기 때문에 특정 위치를 지정하는 인덱스가 필요 없음
```
